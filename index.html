<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pikeville Bear Tracker</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <style>
      :root {
        --bg: #0f172a;
        --panel: #111827;
        --muted: #94a3b8;
        --text: #e5e7eb;
        --accent: #22d3ee;
        --accent-2: #f59e0b;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        background: var(--bg);
        color: var(--text);
        font-family: system-ui, sans-serif;
        display: grid;
        grid-template-rows: 56px 1fr 56px;
      }

      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 0 12px;
        border-bottom: 1px solid #1f2937;
        background: #0b1220;
      }
      header h1 {
        margin: 0;
        font-size: 18px;
        white-space: nowrap;
      }
      .header-tools {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .btn {
        background: #1f2937;
        color: var(--text);
        border: 1px solid #374151;
        border-radius: 8px;
        padding: 6px 10px;
        cursor: pointer;
      }
      .search {
        width: 240px;
        background: #0b1220;
        color: var(--text);
        border: 1px solid #374151;
        border-radius: 8px;
        padding: 6px 10px;
      }

      main {
        position: relative;
      }
      .wrap {
        position: absolute;
        inset: 0;
        display: grid;
        grid-template-columns: 1fr 360px;
      }
      #map {
        width: 100%;
        height: 100%;
      }

      aside {
        background: var(--panel);
        border-left: 1px solid #1f2937;
        padding: 14px;
        overflow: auto;
        transition: transform 0.25s ease;
      }
      aside h2 {
        margin: 0 0 8px 0;
        font-size: 18px;
      }
      .field {
        margin-bottom: 10px;
      }
      .label {
        display: block;
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 4px;
      }
      .value {
        background: #0b1220;
        border: 1px solid #374151;
        border-radius: 6px;
        padding: 8px;
      }

      .bear-photo {
        width: 100%;
        height: auto;
        border-radius: 8px;
        border: 1px solid #1f2937;
        margin-top: 8px;
        display: none;
      }

      .drawer {
        position: absolute;
        left: 8px;
        bottom: 68px;
        display: grid;
        gap: 6px;
      }
      .card {
        background: rgba(17, 24, 39, 0.9);
        backdrop-filter: blur(6px);
        border: 1px solid #1f2937;
        border-radius: 8px;
        padding: 8px;
        width: 300px;
      }
      .card h3 {
        margin: 0 0 6px 0;
        font-size: 14px;
      }
      .list {
        max-height: 260px;
        overflow: auto;
        display: grid;
        gap: 6px;
      }
      .item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #1f2937;
        cursor: pointer;
      }
      .iconbox {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        background: #0b1220;
        display: grid;
        place-items: center;
      }
      .small {
        font-size: 12px;
        color: var(--muted);
      }

      .map-btn {
        position: absolute;
        right: 8px;
        z-index: 450;
        background: #1f2937;
        color: var(--text);
        border: 1px solid #374151;
        padding: 6px 10px;
        border-radius: 8px;
      }
      #locateBtn {
        bottom: 76px;
      }
      .touch-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 400;
        background: #1f2937;
        border: 1px solid #374151;
        color: #e5e7eb;
        padding: 8px 10px;
        border-radius: 8px;
        display: none;
      }

      footer {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        border-top: 1px solid #1f2937;
        background: #0b1220;
        padding: 8px 12px;
        color: var(--muted);
      }
      footer img {
        height: 28px;
        width: auto;
        object-fit: contain;
      }

      .default-bear-icon {
        background: #111827;
        border: 2px solid var(--accent-2);
        color: var(--accent-2);
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        font-size: 14px;
      }

      /* Mobile mode toggled via .mode-mobile on <body> */
      body.mode-mobile .wrap {
        grid-template-columns: 1fr;
      }
      body.mode-mobile aside {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-width: 100%;
        transform: translateX(100%);
        border-left: none;
        border-top: 1px solid #1f2937;
        z-index: 500;
      }
      body.mode-mobile aside.open {
        transform: translateX(0);
      }
      body.mode-mobile .touch-btn {
        display: block;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>üêª Pikeville Bear Tracker</h1>
      <div class="header-tools">
        <input id="searchHeader" class="search" placeholder="Search bears‚Ä¶" />
        <button class="btn" id="openDetailsTop">Details</button>
        <button class="btn" id="locateTop">Locate Me</button>
      </div>
    </header>
    <main>
      <div class="wrap">
        <div id="map"></div>
        <button class="touch-btn" id="openDetails">Details</button>
        <button class="map-btn" id="locateBtn">Locate Me</button>
        <aside id="panel">
          <button
            class="btn"
            id="closeDetails"
            style="display: none; margin-left: auto"
          >
            ‚úï Close
          </button>
          <h2 id="panelTitle">Select a Bear</h2>
          <div id="details">
            <div class="field">
              <span class="label">Bear Name</span>
              <div class="value" id="vName">‚Äî</div>
            </div>
            <div class="field">
              <span class="label">Artist</span>
              <div class="value" id="vArtist">‚Äî</div>
            </div>
            <div class="field">
              <span class="label">About</span>
              <div class="value" id="vAbout">‚Äî</div>
            </div>
            <div class="field">
              <span class="label">Location</span>
              <div class="value" id="vCoords">‚Äî</div>
            </div>
            <img id="vImage" class="bear-photo" alt="Bear photo" />
          </div>
        </aside>
        <div class="drawer">
          <div class="card">
            <h3>All Bears <span class="small" id="listCount"></span></h3>
            <input
              id="searchInput"
              class="search"
              placeholder="Search bears‚Ä¶"
              style="width: 100%"
            />
            <div class="list" id="bearList"></div>
          </div>
        </div>
      </div>
    </main>
    <footer>
      <span>Sponsored by Bit Source</span>
      <a
        href="https://bitsourceky.com"
        target="_blank"
        rel="noopener"
        aria-label="Visit Bit Source"
      >
        <img
          src="/assets/bit_source_logo_blue_fade.webp"
          alt="Bit Source logo"
        />
      </a>
    </footer>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script>
      // ===== Config & Data =====
      const DEFAULT_CENTER = [37.480639, -82.518861];
      const DEFAULT_ZOOM = 14;

      // Edit these per bear as needed (fixed broken string quotes)
      const bears = [
        {
          id: 1,
          name: "Army Bear",
          artist: "Jordan Justice",
          about: "Honoring those who serve in the army.",
          lat: 37.48116,
          lng: -82.51854,
          image: "./assets/images/army.png",
        },
        {
          id: 2,
          name: "Astro Bear",
          artist: "Damon Farmer",
          about: "Under Repair?",
          lat: 37.48029627763524,
          lng: -82.51172265113279,
          image: "./assets/images/astro.jpg",
        },
        {
          id: 3,
          name: "Aurora Bear",
          artist: "Michelle Weston",
          about: "Aurora Borealis",
          lat: 37.48038,
          lng: -82.51748,
          image: "./assets/images/aurora.jpg",
        },
        {
          id: 4,
          name: "Banjo Bear",
          artist: "Damon Farmer",
          about: "Appalachian Folk Instruments",
          lat: 37.48032508,
          lng: -82.51695467,
          image: "./assets/images/banjo.jpg",
        },
        {
          id: 5,
          name: "Bombsheel Bear",
          artist: "Artist",
          about: "Honoring the arts and the theater, and female acrtresses.",
          lat: 37.47996781,
          lng: -82.51838093,
          image: "./assets/images/group.jpg",
        },
        {
          id: 6,
          name: "Buster Bear",
          artist: "Keritsan Tackett",
          about: "The statue is dressed in the department‚Äôs short-sleeved dress blue uniform, modeled after what officers wear at ceremonial events. Branham said it‚Äôs meant to represent and honor current officers as well as those who‚Äôve come before. Buster Edmonds was the first police academy graduate of the Pikeville Police Department. He was the first police chief who was a certified police officer.",
          lat: 37.480646,
          lng: -82.51873624,
          image: "./assets/images/buster.webp",
        },
        {
          id: 7,
          name: "Cartoon Bear",
          artist: "Christopher Epling",
          about: "Cartoonist",
          lat: 37.47989576,
          lng: -82.51846307,
          image: "./assets/images/cartoon.png",
        },
        {
          id: 8,
          name: "Celly Bear (Appalachian Wireless Bear)",
          artist: "Jordan Justice",
          about: "Appalachian Wireless Communications",
          lat: 37.47809,
          lng: -82.51771,
          image: "./assets/images/celly.jpg",
        },
        {
          id: 9,
          name: "Coal Mining Bear",
          artist: "Damon Farmer",
          about: "Honoring Coal Miners",
          lat: 37.47976091,
          lng: -82.51841677,
          image: "./assets/images/miner.jpg",
        },
        {
          id: 10,
          name: "Crazy Bear",
          artist: "Judith Vermillion",
          about: "",
          lat: 37.47617,
          lng: -82.52232,
          image: "./assets/images/crazy.jpg",
        },
        {
          id: 11,
          name: "Flower Bear",
          artist: "Artist",
          about: "",
          lat: 37.4764255,
          lng: -82.51858492,
          image: "./assets/images/flower.jpg",
        },
        {
          id: 12,
          name: "Hatfield Bear",
          artist: "Damon Farmer",
          about: "Celebrating the long lineage of the Hatfields.",
          lat: 37.47859,
          lng: -82.52119,
          image: "./assets/images/hatfield.jpg",
        },
        {
          id: 13,
          name: "Hillbilly Bear",
          artist: "Jordan Justice",
          about: "Celebrating the Annual Hillbilly Days Event",
          lat: 37.47771,
          lng: -82.51879,
          image: "./assets/images/hillbilly.jpg",
        },
        {
          id: 14,
          name: "Honey Bear",
          artist: "Linda Thacker",
          about: "Celebrating Polinators ",
          lat: 37.47727,
          lng: -82.51754,
          image: "./assets/images/honey.jpg",
        },
        {
          id: 15,
          name: "Kindness Bear ‚Äì Autism (Ava Center)",
          artist: "Christopher Epling",
          about: "Honoring the Ava Center.",
          lat: 37.47623534,
          lng: -82.51530381,
          image: "./assets/images/kindness.jpg",
        },
        {
          id: 16,
          name: "Mama Bear",
          artist: "Heather Stiltner",
          about: "Celebrating the culture of appalachian women ",
          lat: 37.4792233,
          lng: -82.51902267,
          image: "./assets/images/mamabear.png",
        },
        {
          id: 17,
          name: "Masonic Bear",
          artist: "Jordan Justice",
          about: "Honoring the Masons ",
          lat: 37.48107,
          lng: -82.5181,
          image: "./assets/images/masonic.jpg",
        },
        {
          id: 18,
          name: "Mccoy Bear",
          artist: "Artist",
          about: "Celebrating the long lineage of the McCoys.",
          lat: 37.47859,
          lng: -82.52119,
          image: "./assets/images/mccoy.jpg",
        },
        {
          id: 19,
          name: "McKenzie the Fire Bear",
          artist: "Artist",
          about: "Honoring the Pikeville Fire Department",
          lat: 37.477222,
          lng: -82.516444,
          image: "./assets/images/mckenzie.png",
        },
        {
          id: 20,
          name: "Miner Bear",
          artist: "Artist",
          about: "Honoring Coal mining. ",
          lat: 37.48229311,
          lng: -82.51548886,
          image: "./assets/images/miner.jpg",
        },
        {
          id: 21,
          name: "Moonshine Bear",
          artist: "Artist",
          about: "Missing. ",
          lat: 37.479556991932235,
          lng: -82.51342059233511,
        },
        {
          id: 22,
          name: "Mountain Girl Bear",
          artist: "Artist",
          about: "Celebrating the Mountain Girl Festival. ",
          lat: 37.48006509,
          lng: -82.51862005,
          image: "./assets/images/mtngirl.jpg",
        },
        {
          id: 23,
          name: "Musical Movement Bear",
          artist: "Charles Mims",
          about: "Celebraing music in the mountains",
          lat: 37.47862,
          lng: -82.51788,
          image: "./assets/images/music.jpg",
        },
        {
          id: 24,
          name: "Pride Bear (Friends of Coal)",
          artist: "William Cory Adams",
          about: "Honoring miners.",
          lat: 37.47905846,
          lng: -82.51772444,
          image: "./assets/images/pride.jpg",
        },
        {
          id: 25,
          name: "Story Book Bear",
          artist: "Kaylee Thornsberry",
          about: "Honoring reading and literacy in the mountains. ",
          lat: 37.4765397,
          lng: -82.52160698,
          image: "./assets/images/storybook.png",
        },
        {
          id: 26,
          name: "UK Bear",
          artist: "Payton May",
          about: "Celebraing the UK wildcats. ",
          lat: 37.48048,
          lng: -82.519,
          image: "./assets/images/uk.jpg",
        },
        {
          id: 27,
          name: "UPIKE Bear",
          artist: "Curt Mullins",
          about: "Celebraing Upike. ",
          lat: 37.47912,
          lng: -82.52074,
          image: "./assets/images/upike.jpg",
        },
        {
          id: 28,
          name: "UPIKE Doctor Bear",
          artist: "Artist",
          about: "Honoring all of the MD graduates. ",
          lat: 37.47889586,
          lng: -82.52015579,
          image: "./assets/images/doc.png",
        },
        {
          id: 29,
          name: "UPIKE Seymour Bear",
          artist: "Artist",
          about: "Honoring all of the optomery graduates. ",
          lat: 37.47859,
          lng: -82.52119,
          image: "./assets/images/seemore.png",
        },
        {
          id: 30,
          name: "UPIKE Student",
          artist: "Artist",
          about: "Honoring all of the upike students. ",
          lat: 37.47922824961019,
          lng: -82.5214500480999,
          image: "./assets/images/student.png",
        },
      ];

      // ===== Map =====
      const map = L.map("map");
      const tiles = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        { maxZoom: 20, attribution: "&copy; OpenStreetMap contributors" }
      );
      tiles.addTo(map);
      map.setView(DEFAULT_CENTER, DEFAULT_ZOOM);

      // Fix reflow issues when panels open/close or window resizes
      const invalidate = () => setTimeout(() => map.invalidateSize(), 0);
      window.addEventListener("resize", invalidate);

      // ===== Markers =====
      const markers = new Map();
      const toIcon = () =>
        L.divIcon({
          className: "",
          html: `<div class="default-bear-icon">üêª</div>`,
          iconSize: [28, 28],
          iconAnchor: [14, 14],
        });
      const popupHTML = (b) =>
        `<div style="font-weight:700;">${b.name}</div><div class="small">${
          b.artist || ""
        }</div>`;

      function upsertMarker(b) {
        if (typeof b.lat !== "number" || typeof b.lng !== "number") return; // hide if no coords yet
        let m = markers.get(b.id);
        if (!m) {
          m = L.marker([b.lat, b.lng], { icon: toIcon() }).addTo(map);
          m.on("click", () => showDetails(b));
          m.bindPopup(popupHTML(b));
          markers.set(b.id, m);
        } else {
          m.setLatLng([b.lat, b.lng]);
          m.setPopupContent(popupHTML(b));
        }
      }
      function renderMarkers(list) {
        markers.forEach((m) => map.removeLayer(m));
        markers.clear();
        list.forEach(upsertMarker);
      }

      // ===== Details Panel =====
      const panel = document.getElementById("panel");
      const vName = document.getElementById("vName");
      const vArtist = document.getElementById("vArtist");
      const vAbout = document.getElementById("vAbout");
      const vCoords = document.getElementById("vCoords");
      const vImage = document.getElementById("vImage");
      const closeBtn = document.getElementById("closeDetails");

      function showDetails(b) {
        vName.textContent = b.name || "‚Äî";
        vArtist.textContent = b.artist || "‚Äî";
        vAbout.textContent = b.about || "‚Äî";
        vCoords.textContent =
          typeof b.lat === "number" && typeof b.lng === "number"
            ? `${b.lat.toFixed(6)}, ${b.lng.toFixed(6)}`
            : "Location coming soon";

        if (b.image) {
          vImage.src = b.image;
          vImage.style.display = "block";
        } else {
          vImage.removeAttribute("src");
          vImage.style.display = "none";
        }

        const m = markers.get(b.id);
        if (m) {
          map.setView(m.getLatLng(), Math.max(map.getZoom(), 16));
          m.openPopup();
        }
        if (document.body.classList.contains("mode-mobile")) openPanel();
      }

      // ===== List + Search =====
      const listCount = document.getElementById("listCount");
      const bearList = document.getElementById("bearList");
      const searchInput = document.getElementById("searchInput");
      const searchHeader = document.getElementById("searchHeader");
      let currentQuery = "";
      const getFiltered = () => {
        const q = currentQuery.trim().toLowerCase();
        if (!q) return bears;
        return bears.filter((b) =>
          (b.name + " " + (b.artist || "")).toLowerCase().includes(q)
        );
      };
      function renderList() {
        const arr = getFiltered();
        listCount.textContent = `(${arr.length})`;
        bearList.innerHTML = "";
        arr.forEach((b) => {
          const row = document.createElement("div");
          row.className = "item";
          row.innerHTML = `
        <div class="iconbox">üêª</div>
        <div class="grow">
          <div style="font-size:13px;font-weight:600;">${b.name}</div>
          <div class="small">${b.artist || ""}</div>
        </div>
        <div class="small">#${b.id}</div>`;
          row.onclick = () => showDetails(b);
          bearList.appendChild(row);
        });
      }
      function setQuery(q) {
        currentQuery = q;
        renderList();
        renderMarkers(getFiltered());
      }
      [searchInput, searchHeader].forEach(
        (el) =>
          el && el.addEventListener("input", (e) => setQuery(e.target.value))
      );

      // ===== Locate Me =====
      function locateUser() {
        if (!navigator.geolocation) {
          alert("Geolocation not supported on this device.");
          return;
        }
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude, longitude, accuracy } = pos.coords;
            const ll = [latitude, longitude];
            map.setView(ll, 16);
            L.marker(ll).addTo(map).bindPopup("You are here").openPopup();
            L.circle(ll, { radius: accuracy }).addTo(map);
          },
          (err) => alert("Location error: " + err.message)
        );
      }
      document
        .getElementById("locateBtn")
        .addEventListener("click", locateUser);
      document
        .getElementById("locateTop")
        .addEventListener("click", locateUser);

      // ===== Mode switching (desktop vs mobile) =====
      const openBtn = document.getElementById("openDetails");
      const openTop = document.getElementById("openDetailsTop");
      function isMobile() {
        return window.innerWidth <= 768;
      }
      function applyMode() {
        const mobile = isMobile();
        document.body.classList.toggle("mode-mobile", mobile);
        if (!mobile) {
          panel.classList.remove("open");
          closeBtn.style.display = "none";
        }
        invalidate();
      }
      function openPanel() {
        panel.classList.add("open");
        closeBtn.style.display = "inline-block";
        invalidate();
      }
      function closePanel() {
        panel.classList.remove("open");
        closeBtn.style.display = "none";
        invalidate();
      }
      window.addEventListener("resize", applyMode);
      openBtn.addEventListener("click", openPanel);
      openTop.addEventListener("click", openPanel);
      closeBtn.addEventListener("click", closePanel);
      applyMode();

      // ===== Init render =====
      renderMarkers(bears);
      renderList();
    </script>
  </body>
</html>
